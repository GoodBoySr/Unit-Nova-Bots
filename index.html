<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit Nova Bots</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Montserrat:wght@600;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom CSS for the background and text */
        body {
            font-family: 'Inter', sans-serif; /* Default font for the body */
            margin: 0;
            overflow: auto; /* Hide overflow to prevent scrollbars from stars */
            min-height: 100vh; width: 100vw; /* Full viewport height */
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* Align content to the top */
            align-items: flex-start; /* Align content to the left */
            position: relative; /* For absolute positioning of text and stars */
            background: linear-gradient(135deg, #6A0DAD, #8A2BE2, #9370DB); /* Purple gradient background */
        }

        .nova-text {
            position: absolute;
            top: 1.5rem; /* Equivalent to Tailwind's top-6 */
            left: 1.5rem; /* Equivalent to Tailwind's left-6 */
            z-index: 10; /* Ensure text is above the background and stars */
            color: white;
            /* Applying a cool font to the main title */
            font-family: 'Montserrat', sans-serif;
            /* Enhanced glow effect */
            text-shadow:
                0 0 10px rgba(255, 255, 255, 0.7), /* Soft white glow */
                0 0 20px rgba(255, 255, 255, 0.5), /* Medium white glow */
                0 0 30px rgba(255, 255, 255, 0.3); /* Wider, subtle white glow */
        }

        /* Stars container */
        .stars-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Allow clicks to pass through */
            z-index: 1; /* Below text, above background */
        }

        /* Star styling */
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%; /* Make them round */
            opacity: 0; /* Start invisible for blinking effect */
            animation: blink-and-move linear infinite;
            /* Added glow effect to stars */
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.8),
                        0 0 10px rgba(255, 255, 255, 0.5);
        }

        /* Keyframes for blinking and moving */
        @keyframes blink-and-move {
            0% {
                transform: translateX(100vw); /* Start off-screen right */
                opacity: 0; /* Start completely invisible */
            }
            20% {
                opacity: 0.8; /* Fade in to visible */
            }
            80% {
                opacity: 0.8; /* Stay visible */
            }
            100% {
                transform: translateX(-100vw); /* Move off-screen left */
                opacity: 0; /* Fade out to invisible */
            }
        }

        /* Styles for the translucent box text and button text */
        .translucent-box-text {
            font-family: 'Poppins', sans-serif; /* Applying a cool font to the box text */
        }

        .button-text {
            font-family: 'Poppins', sans-serif; /* Applying a cool font to the button text */
        }

        /* Input field styling */
        .input-field {
            background-color: rgba(255, 255, 255, 0.2); /* Slightly more opaque for readability */
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            font-family: 'Inter', sans-serif;
            outline: none; /* Remove default focus outline */
            transition: border-color 0.3s ease-in-out;
        }

        .input-field:focus {
            border-color: #9370DB; /* Highlight on focus */
        }

        /* Placeholder color */
        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        /* Password toggle styling */
        .password-toggle {
            cursor: pointer;
            color: rgba(255, 255, 255, 0.7);
            transition: color 0.3s ease-in-out;
            margin-left: 0.5rem; /* Space between input and toggle */
            flex-shrink: 0; /* Prevent it from shrinking */
            display: flex; /* Ensure SVG is properly centered if needed */
            align-items: center;
            justify-content: center;
        }

        .password-toggle:hover {
            color: white;
        }

        /* Custom message box styling (for the new overlay) */
        .custom-message-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Dark overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000; /* Above all other content */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }

        .custom-message-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .custom-message-content {
            background-color: rgba(255, 255, 255, 0.15); /* Translucent white */
            backdrop-filter: blur(8px);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            text-align: center;
            color: white;
            font-family: 'Poppins', sans-serif;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 90%;
            max-width: 400px;
        }

        .custom-message-content .message-text {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .custom-message-content .close-button {
            background-color: #8A2BE2; /* Purple */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease-in-out;
        }

        .custom-message-content .close-button:hover {
            background-color: #9370DB;
        }


        /* Submit Button specific styling */
        .submit-button-glow {
            /* Purple background */
            background-color: #8A2BE2; /* A vibrant purple */
            /* Glowing effect */
            box-shadow:
                0 0 5px rgba(138, 43, 226, 0.7), /* Soft purple glow */
                0 0 15px rgba(138, 43, 226, 0.5), /* Medium purple glow */
                0 0 25px rgba(138, 43, 226, 0.3); /* Wider purple glow */
        }

        /* Navigation buttons container styling */
        .nav-buttons-container {
            position: absolute;
            top: 1.5rem; /* Align with nova-text's top */
            right: 1.5rem; /* Place in the top right corner */
            display: flex;
            gap: 1rem; /* Space between buttons */
            z-index: 10; /* Ensure it's above other elements */
        }

        .nav-button {
            color: white;
            font-weight: bold;
            text-decoration: underline;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            padding: 0.5rem 1.5rem; /* Increased padding for better click area */
            transition: color 0.3s ease-in-out, text-shadow 0.3s ease-in-out; /* Add text-shadow to transition */
        }

        .nav-button:hover {
            color: #DDA0DD; /* Lighter purple on hover */
        }

        /* Glow effect for navigation buttons */
        .nav-button.glow {
            text-shadow:
                0 0 5px rgba(255, 255, 255, 0.7),
                0 0 10px rgba(255, 255, 255, 0.5);
        }

        /* Darken effect for navigation buttons */
        .nav-button.darken {
            color: rgba(255, 255, 255, 0.5); /* Make text semi-transparent */
            text-shadow: none; /* Remove glow */
        }

        /* Modal for password input */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Dark overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000; /* Above all other content */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: rgba(255, 255, 255, 0.15); /* Translucent white */
            backdrop-filter: blur(8px);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            text-align: center;
            color: white;
            font-family: 'Poppins', sans-serif;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 90%;
            max-width: 400px;
        }

        .modal-input {
            background-color: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: white;
            padding: 0.75rem;
            border-radius: 0.5rem;
            outline: none;
            font-family: 'Inter', sans-serif;
            width: 100%;
        }

        .modal-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .modal-button {
            background-color: #8A2BE2;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: background-color 0.3s ease-in-out;
        }

        .modal-button:hover {
            background-color: #9370DB;
        }

        .modal-error {
            color: #ffcccc;
            font-size: 0.9rem;
        }

        /* Admin Panel specific styles */
        .admin-panel-content {
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 800px;
            margin-top: 2rem;
            margin-bottom: 2rem;
            text-align: center;
            display: flex; /* Use flexbox for content alignment */
            flex-direction: column;
            align-items: center;
        }

        .accounts-section {
            width: 100%;
            margin-top: 1.5rem;
            text-align: left;
            background-color: rgba(255, 255, 255, 0.05); /* Slightly darker translucent */
            border-radius: 0.5rem;
            padding: 1rem;
            max-height: 400px; /* Limit height for scrolling */
            overflow-y: auto; /* Enable scrolling for the list */
        }

        .accounts-section h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1rem;
            text-align: center;
        }

        /* Responsive adjustments for account items in admin panel */
        .account-item {
            background-color: rgba(255, 255, 255, 0.08);
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column; /* Stack vertically by default for mobile */
            align-items: flex-start; /* Align text to the left */
            gap: 0.5rem; /* Space between items */
        }

        .account-item:last-child {
            margin-bottom: 0;
        }

        .account-item strong {
            color: #DDA0DD;
        }

        .account-info {
            flex-grow: 1; /* Allow info to take available space */
            min-width: 150px; /* Ensure info doesn't get too squished */
        }

        .account-actions {
            display: flex;
            gap: 0.5rem;
            flex-shrink: 0; /* Prevent actions from shrinking */
            width: 100%; /* Take full width on mobile */
            justify-content: space-around; /* Distribute buttons evenly */
            margin-top: 0.5rem; /* Space between info and buttons */
        }

        /* Revert to horizontal layout for larger screens */
        @media (min-width: 640px) { /* Tailwind's sm breakpoint */
            .account-item {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
            }
            .account-actions {
                width: auto;
                justify-content: flex-end;
                margin-top: 0;
            }
        }

        .action-button {
            background-color: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.4rem 0.6rem;
            border-radius: 0.3rem;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-button.check {
            color: #4CAF50; /* Green check */
            border-color: #4CAF50;
        }
        .action-button.check:hover {
            background-color: #4CAF50;
            color: white;
        }

        .action-button.remove {
            color: #DC2626; /* Red X */
            border-color: #DC2626;
        }
        .action-button.remove:hover {
            background-color: #DC2626;
            color: white;
        }
        
        .action-button.chat { /* New chat button style */
            color: #ADD8E6; /* Light blue */
            border-color: #ADD8E6;
        }
        .action-button.chat:hover {
            background-color: #ADD8E6;
            color: white;
        }

        .action-button.delete-ui { /* New delete UI button style */
            color: #FFD700; /* Gold/Yellow */
            border-color: #FFD700;
        }
        .action-button.delete-ui:hover {
            background-color: #FFD700;
            color: black;
        }


        .logout-button {
            background-color: #DC2626; /* Red color for logout */
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: background-color 0.3s ease-in-out;
            margin-top: 1rem;
        }

        .logout-button:hover {
            background-color: #B91C1C;
        }

        /* Chat Page Specific Styles */
        .chat-page-content {
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            padding: 1.5rem; /* Default padding for mobile */
            border-radius: 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 600px;
            height: 80vh; /* Make chat area take most of the height */
            margin-top: 2rem;
            margin-bottom: 2rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Push input to bottom */
        }

        @media (min-width: 640px) { /* Tailwind's sm breakpoint */
            .chat-page-content {
                padding: 2rem; /* Restore larger padding for larger screens */
            }
        }

        .chat-header {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.75rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1rem;
            text-align: center;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chat-messages-container {
            flex-grow: 1; /* Take all available space */
            overflow-y: auto; /* Enable scrolling for messages */
            padding: 0.5rem;
            margin-bottom: 1rem;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 0.5rem;
            display: flex;
            flex-direction: column; /* Messages stack vertically */
        }

        .chat-input-container {
            display: flex;
            gap: 0.5rem;
            width: 100%;
        }

        .chat-input-field {
            flex-grow: 1;
            background-color: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: white;
            padding: 0.75rem;
            border-radius: 0.5rem;
            outline: none;
            font-family: 'Inter', sans-serif;
            resize: none; /* Prevent manual resizing */
            min-height: 40px; /* Ensure a minimum height */
            height: auto; /* Allow height to adjust based on content */
        }

        .chat-input-field::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .chat-send-button {
            background-color: #8A2BE2;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: background-color 0.3s ease-in-out;
            flex-shrink: 0; /* Prevent button from shrinking */
        }

        .chat-send-button:hover {
            background-color: #9370DB;
        }

        /* Individual message styling */
        
.message-item {
    background-color: transparent;
    margin-bottom: 0.5rem;
    max-width: 70%;
    font-size: 1rem;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}
.message-item.sent {
    align-self: flex-end;
    align-items: flex-end;
}
.message-item .bubble {
    background-color: rgba(255, 255, 255, 0.15);
    padding: 0.6rem 0.8rem;
    border-radius: 0.8rem;
    word-wrap: break-word;
}
.message-item.sent .bubble {
    background-color: rgba(138, 43, 226, 0.3);
}
.message-timestamp {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.7);
    margin-top: 0.2rem;
    display: block;
}


        .message-timestamp {
            font-size: 0.75rem; /* Smaller font for timestamp */
            color: rgba(255, 255, 255, 0.7); /* Slightly dimmed color */
            margin-top: 0.2rem;
            display: block; /* Ensure it's on its own line */
        }

        .close-chat-button {
            background-color: #DC2626; /* Red color for close */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: background-color 0.3s ease-in-out;
            margin-top: 1rem; /* Space from chat input */
            align-self: center; /* Center the button */
        }

        .close-chat-button:hover {
            background-color: #B91C1C;
        }

        /* New Chat Overlay for "Chat with Admin" */
        .chat-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Dark overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000; /* Above all other content */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }

        .chat-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .chat-overlay-content {
            background-color: rgba(255, 255, 255, 0.15); /* Translucent white */
            backdrop-filter: blur(8px);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            text-align: center;
            color: white;
            font-family: 'Poppins', sans-serif;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 90%;
            max-width: 400px;
        }

        /* Big Animated Chat Button */
        .big-chat-button-container {
            position: fixed;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1500; /* Below overlays, above main content */
            transition: all 1s ease-in-out; /* Smooth transition for size and position */
            opacity: 1;
        }

        .big-chat-button-initial {
            top: 0;
            left: 0;
            width: 100vw;
            min-height: 100vh; width: 100vw;
            font-size: 5rem; /* Very large text */
            background-color: #8A2BE2; /* Purple background */
            border-radius: 0; /* No rounded corners initially */
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 1;
        }

        .big-chat-button-final {
            top: 1.5rem; /* Target top for nav bar */
            right: 1.5rem; /* Target right for nav bar */
            width: 120px; /* Approximate width of nav button */
            height: 40px; /* Approximate height of nav button */
            font-size: 1rem; /* Normal font size */
            background-color: #8A2BE2;
            border-radius: 0.5rem; /* Normal rounded corners */
            opacity: 1;
            transform: translate(0, 0) scale(1); /* Ensure no residual transform */
        }

        /* Green Glow for userChatButton */
        @keyframes greenGlow {
            0%, 100% {
                box-shadow: 0 0 5px rgba(144, 238, 144, 0.5), /* Light green glow */
                            0 0 10px rgba(144, 238, 144, 0.3);
            }
            50% {
                box-shadow: 0 0 10px rgba(144, 238, 144, 0.8),
                            0 0 20px rgba(144, 238, 144, 0.6);
            }
        }

        .green-glow {
            animation: greenGlow 2s infinite alternate; /* Apply blinking green glow */
        }

        /* Powered by text styling */
        .powered-by-text {
            color: rgba(255, 255, 255, 0.7); /* Slightly dimmed white */
            font-size: 0.875rem; /* Small font size */
            font-family: 'Poppins', sans-serif;
            margin-top: 1rem; /* Space from elements above */
            text-align: center;
        }

        /* Responsive padding for main content areas */
        #mainContent, #adminPanelContent, #chatPageContent {
            padding: 1.5rem; /* Default padding for smaller screens */
        }

        @media (min-width: 640px) { /* Tailwind's sm breakpoint */
            #mainContent, #adminPanelContent, #chatPageContent {
                padding: 2rem; /* Restore larger padding for larger screens */
            }
        }

        /* Floating animation for the tutorial button */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .animate-float {
            animation: float 2s ease-in-out infinite;
        }

        /* Chat Greeting Box */
        .chat-greeting-box {
            background-color: rgba(0, 0, 0, 0.5); /* Dark translucent background */
            color: white;
            padding: 0.75rem 1.25rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            text-align: center;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            width: 100%; /* Take full width of chat container */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            cursor: pointer; /* Indicate it's clickable */
            display: none; /* Hidden by default, shown on input focus */
        }

        /* New overlay for "Account Accepted" message */
        #accountAcceptedOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); /* Darker overlay */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 4000; /* Higher than other overlays */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
        }

        #accountAcceptedOverlay.show {
            opacity: 1;
            visibility: visible;
        }

        #accountAcceptedText {
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5rem; /* Large text */
            font-weight: bold;
            text-align: center;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
        }

        /* Styles for animating the userChatButton */
        .user-chat-button-animating {
            transition: all 1s ease-in-out; /* Smooth transition for all properties */
            position: fixed !important; /* Override other positioning */
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) scale(3) !important; /* Start large and centered */
            font-size: 2.5rem !important; /* Large font size */
            opacity: 1 !important;
            z-index: 4001; /* Above the account accepted overlay */
            width: auto !important; /* Allow content to dictate width */
            height: auto !important; /* Allow content to dictate height */
            padding: 1rem 2rem !important; /* Larger padding for the big state */
        }
    </style>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
    html, body {
        overflow-x: hidden;
    }
</style>

</head>
<body>
    <div class="nova-text text-4xl font-bold p-4 rounded-lg">
        Unit Nova Bots
    </div>

    <div class="nav-buttons-container">
        <button class="nav-button" id="mainButton">Main</button>
        <button class="nav-button" id="adminButton">Admin</button>
        <button class="nav-button hidden" id="userChatButton">Chat</button> </div>

    
<audio autoplay loop id="bgMusic">
    <source src="https://cdn.pixabay.com/audio/2022/10/13/audio_d5a56c2d7e.mp3" type="audio/mpeg">
</audio>

<div class="stars-container" id="starsContainer"></div>

<canvas id="explosionCanvas" style="position:fixed;pointer-events:none;top:0;left:0;width:100%;height:100%;z-index:999;"></canvas>
<audio id="clickSound">
    <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_c6a7da2525.mp3" type="audio/mpeg">
</audio>
<audio id="sendMessageSound">
    <source src="https://cdn.pixabay.com/audio/2022/03/10/audio_b2089f2d01.mp3" type="audio/mpeg">
</audio>

    <div class="relative w-screen min-h-screen flex items-center justify-center p-4">
        <div id="mainContent" class="bg-white/10 backdrop-blur-sm p-8 rounded-lg shadow-xl flex flex-col items-center justify-center space-y-4">
            <p class="text-white text-lg text-center translucent-box-text">Welcome to Unit Nova</p>

            <button class="bg-purple-700 hover:bg-purple-800 text-white font-bold py-2 px-4 rounded-full transition duration-300 ease-in-out button-text" onclick="window.open('https://www.roblox.com/createaccount', '_blank');">
                Create an Alt account
            </button>

            <div class="flex flex-col items-center w-full max-w-xs">
                <input type="text" id="altUsername" placeholder="Alt Username" class="input-field w-full">
                <span id="usernameError" class="error-message"></span>
            </div>

            <div class="flex flex-col items-center w-full max-w-xs">
                <div class="flex items-center w-full">
                    <input type="password" id="altPassword" placeholder="Alt Password" class="input-field flex-grow">
                    <span class="password-toggle" id="togglePassword">
                        <!-- Updated Eye Icons for better visibility -->
                        <svg id="eyeOpen" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 hidden">
                            <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                            <path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12 3.75c4.972 0 9.189 3.226 10.677 7.697a1.125 1.125 0 0 1 0 .898C21.189 17.024 16.972 20.25 12 20.25c-4.972 0-9.189-3.226-10.677-7.697a1.125 1.125 0 0 1 0-.898Z" clip-rule="evenodd" />
                        </svg>
                        <svg id="eyeClosed" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                            <path d="m11.69 11.69 3.01-3.01m-2.25 2.25 2.25 2.25M3.636 11.447A9.955 9.955 0 0 1 12 5.25c4.46 0 8.204 2.478 9.756 7.447M10.5 12a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm-3.75 0a3.75 3.75 0 1 1 7.5 0 3.75 3.75 0 0 1-7.5 0ZM12 15.75c-1.727 0-3.424-.102-5.07-.294m5.07.294v2.25A2.25 2.25 0 0 1 9.75 20.25v-2.625c-1.668.078-3.321.21-4.946.39M12 15.75c1.727 0 3.424-.102 5.07-.294m-5.07.294v2.25c1.115 0 2.199-.199 3.25-.55M12 12c-1.727 0-3.424-.102-5.07-.294m5.07.294c.175.02.35.04.524.058m-5.07-.294c-.175.02-.35.04-.524.058M14.25 12a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0ZM12 12c.175.02.35.04.524.058m-5.07-.294c.175.02.35.04.524.058M12 15.75c-1.727 0-3.424-.102-5.07-.294m5.07.294v2.25A2.25 2.25 0 0 1 9.75 20.25v-2.625c-1.668.078-3.321.21-4.946.39M12 15.75c1.727 0 3.424-.102 5.07-.294m-5.07.294v2.25c1.115 0 2.199-.199 3.25-.55M12 12c-1.727 0-3.424-.102-5.07-.294m5.07.294c.175.02.35.04.524.058m-5.07-.294c-.175.02-.35.04-.524.058" />
                        </svg>
                    </span>
                </div>
                <span id="passwordError" class="error-message"></span>
            </div>

            <button id="submitButton" class="bg-purple-700 hover:bg-purple-800 text-white font-bold py-2 px-4 rounded-full transition duration-300 ease-in-out button-text submit-button-glow">
                Submit
            </button>

            <p class="powered-by-text">Powered by Roblox Bots</p>
        </div>

        <div id="adminPanelContent" class="admin-panel-content hidden">
            <h1 class="text-5xl font-bold mb-4">Admin Panel</h1>
            <button id="robloxLoginButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 ease-in-out button-text mb-4">
                Go to Roblox Login
            </button>

            <div class="accounts-section">
                <h2>Submitted Alt Accounts</h2>
                <div id="submittedAccountsList">
                    <p class="text-gray-400" id="noSubmittedAccountsMessage">No submitted accounts yet.</p>
                </div>
            </div>

            <div class="accounts-section mt-8">
                <h2>Accepted Alt Accounts</h2>
                <div id="acceptedAccountsList">
                    <p class="text-gray-400" id="noAcceptedAccountsMessage">No accepted accounts yet.</p>
                </div>
            </div>
            
            <button id="logoutAdminButton" class="logout-button">Logout Admin</button>
        </div>

        <div id="chatPageContent" class="chat-page-content hidden">
            <h1 class="chat-header" id="chatHeader"></h1>
            
            <div id="chatGreetingBox" class="chat-greeting-box">
                Hello! Can you turn on the bot now?
            </div>

            <div class="chat-messages-container" id="chatMessagesContainer">
                <p class="text-gray-400 text-center">No messages yet. Start chatting!</p>
            </div>

            <div class="chat-input-container">
                <textarea id="chatInput" placeholder="Type your message..." class="chat-input-field" rows="1"></textarea>
                <button id="sendButton" class="chat-send-button flex items-center justify-center">
                    <!-- Paper Airplane Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                        <path d="M3.478 2.405a.75.75 0 0 0-.926.94l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.599 60.599 0 0 0 18.445-8.852.75.75 0 0 0 0-1.218A60.599 60.599 0 0 0 3.478 2.405Z" />
                    </svg>
                </button>
                <p id="chatIdDisplay" class="text-white mt-2 text-sm text-center"></p> <!-- Added as per user's request -->
            </div>
            <button id="closeChatButton" class="close-chat-button">Close</button> </div>
    </div>

    <div id="chatWithAdminOverlay" class="chat-overlay">
        <div class="chat-overlay-content">
            <p class="message-text">Chat with Admin</p>
            <button id="chatWithAdminOverlayOkayButton" class="close-button">Okay</button>
        </div>
    </div>

    <div id="adminPasswordModal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="text-xl font-bold">Admin Access</h3>
            <input type="password" id="adminPasswordInput" placeholder="Enter Admin Password" class="modal-input">
            <span id="adminPasswordError" class="modal-error hidden">Incorrect password.</span>
            <div class="flex justify-center space-x-4">
                <button id="confirmAdminPassword" class="modal-button">Confirm</button>
                <button id="cancelAdminPassword" class="modal-button bg-gray-600 hover:bg-gray-700">Cancel</button>
            </div>
        </div>
    </div>

    <div id="customMessageOverlay" class="custom-message-overlay">
        <div id="customMessageContent" class="custom-message-content">
            <p id="customMessageText" class="message-text"></p>
            <button id="customMessageCloseButton" class="close-button">Close</button>
        </div>
    </div>

    <!-- Overlay for Account Decision -->
    <div id="accountDecisionOverlay" class="custom-message-overlay">
      <div class="custom-message-content">
        <p id="accountDecisionText" class="message-text"></p>
        <button id="accountDecisionOkay" class="close-button">Okay</button>
      </div>
    </div>

    <!-- Notification Bubble -->
    <div id="notificationBubble" style="position: fixed; top: 1rem; right: 1rem; background: rgba(0,0,0,0.7); color: white; padding: 1rem 1.5rem; border-radius: 0.75rem; display: none; z-index: 9999; font-family: Poppins, sans-serif; font-weight: bold;"></div>

    <!-- New Tutorial Button -->
    <button id="watchTutorialButton" class="fixed bottom-4 left-4 bg-purple-700 hover:bg-purple-800 text-white font-bold py-3 px-6 rounded-full transition duration-300 ease-in-out button-text shadow-lg transform hover:scale-105 animate-float z-50">
        Watch Tutorial
    </button>

    <!-- Account Accepted Animation Overlay -->
    <div id="accountAcceptedOverlay">
        <p id="accountAcceptedText" class="hidden">Your account was accepted, Discuss with Admin!</p>
    </div>

<script type="module">
// Firebase Imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-analytics.js";
import { getDatabase, ref, push, onChildAdded, onValue, set, remove } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";

// Firebase Configuration
const firebaseConfig = {
  apiKey: "AIzaSyDEXPa2hL26ramq26kOObputL0ocyijQ9s",
  authDomain: "chat-n-account-app.firebaseapp.com",
  projectId: "chat-n-account-app",
  storageBucket: "chat-n-account-app.firebasestorage.app",
  messagingSenderId: "285075561198",
  appId: "1:285075561198:web:d3faabc7a8191d43d4b1ff",
  measurementId: "G-MW7D8Z16MT"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app); // Initialize analytics
const db = getDatabase(app); // Initialize Realtime Database

// Global variables for chat functionality
let currentChatPartnerId = null; 
let currentUserIsAdmin = false;
let currentChatListenerUnsubscribe = null; // To store the unsubscribe function for chat messages

// Declare all global variables here to avoid redeclaration errors within DOMContentLoaded
let altUsernameInput, usernameError, altPasswordInput, passwordError, togglePassword, eyeOpenIcon, eyeClosedIcon, submitButton;
let mainButton, adminButton, adminPasswordModal, adminPasswordInput, adminPasswordError, confirmAdminPasswordButton, cancelAdminPasswordButton;
let mainContent, adminPanelContent, chatPageContent, submittedAccountsListDiv, acceptedAccountsListDiv, noSubmittedAccountsMessage, noAcceptedAccountsMessage, logoutAdminButton;
let customMessageOverlay, customMessageContent, customMessageText, customMessageCloseButton;
let userChatButton, chatHeader, chatMessagesContainer, chatInput, sendButton, closeChatButton, chatGreetingBox;
let chatWithAdminOverlay, chatWithAdminOverlayOkayButton;
let sendMessageSound; // Declare sendMessageSound globally

// New global variables for tutorial button
let watchTutorialButton;
let robloxLoginButton; // New Roblox Login Button

// New global variables for account accepted animation
let accountAcceptedOverlay, accountAcceptedText;

// Particle effect variables
let canvas, ctx;
let particles = [];
let clickSound; // Declared globally


// Function to get the storage key for the current chat
const getChatStorageKey = () => {
    if (currentUserIsAdmin) {
        // Admin is chatting with a specific user, format as CH########
        return `chats/CH${currentChatPartnerId.replace(/\D/g, '').padStart(8, '0')}`;
    } else {
        // User is chatting with admin, format as CH######## based on user's ID
        const id = localStorage.getItem('currentUserAltId') || '';
        return `chats/CH${id.replace(/\D/g, '').padStart(8, '0')}`;
    }
};

// Function to load and display messages from Firebase
function displayMessages() {
    if (!chatMessagesContainer) return;

    // Detach previous listener if it exists
    if (currentChatListenerUnsubscribe) {
        currentChatListenerUnsubscribe();
        currentChatListenerUnsubscribe = null;
    }

    chatMessagesContainer.innerHTML = ''; // Clear previous messages
    const chatKey = getChatStorageKey();
    document.getElementById('chatIdDisplay').textContent = `Chat ID: ${chatKey.split('/')[1]}`; // Show Chat ID without 'chats/'

    const chatRef = ref(db, chatKey);

    // Listen for new messages
    currentChatListenerUnsubscribe = onChildAdded(chatRef, (snapshot) => {
        const msg = snapshot.val();
        const messageItem = document.createElement('div');
        messageItem.classList.add('message-item');

        // Determine if the message was sent by the current user (admin or regular user)
        if ((currentUserIsAdmin && msg.sender === 'admin') || (!currentUserIsAdmin && msg.sender === 'user')) {
            messageItem.classList.add('sent');
            messageItem.innerHTML = `
                <div class="bubble" style="background-color:#3B82F6; color:white;">${msg.message}</div>
                <span class="message-timestamp">(${new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} - ${new Date(msg.timestamp).toLocaleDateString()})</span>
            `;
        } else {
            messageItem.classList.add('received');
            messageItem.innerHTML = `
                <div class="bubble" style="background-color:white; color:black;">${msg.message}</div>
                <span class="message-timestamp">(${new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} - ${new Date(msg.timestamp).toLocaleDateString()})</span>
            `;
        }

        chatMessagesContainer.appendChild(messageItem);
        chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight; // Scroll to bottom
    });
}

// Function to send a message
function sendMessage() {
    if (!chatInput) {
        console.error("Chat input not found.");
        return;
    }
    const messageText = chatInput.value.trim();
    if (messageText === '') return; // Don't send empty messages

    const chatKey = getChatStorageKey();
    const senderRole = currentUserIsAdmin ? 'admin' : 'user';
    const newMessage = {
        sender: senderRole,
        message: messageText,
        timestamp: new Date().toISOString()
    };
    
    const chatRef = ref(db, chatKey); // Get Firebase reference for the specific chat key
    push(chatRef, newMessage); // Push the new message to Firebase Realtime Database

    chatInput.value = ''; // Clear input field

    // Play send message sound
    if (sendMessageSound) {
        sendMessageSound.currentTime = 0;
        sendMessageSound.play();
    }
}

// Function to load and display accounts from Firebase Realtime Database
function loadAccounts() {
    console.log("Loading accounts for Admin Panel from Firebase...");

    // Clear previous content
    if (submittedAccountsListDiv) submittedAccountsListDiv.innerHTML = '';
    if (acceptedAccountsListDiv) acceptedAccountsListDiv.innerHTML = '';

    // Submitted Accounts Listener
    const submittedRef = ref(db, 'submittedAccounts');
    onValue(submittedRef, (snapshot) => {
        const data = snapshot.val();
        let submittedAccounts = [];
        if (data) {
            submittedAccounts = Object.keys(data).map(key => ({ id: key, ...data[key] }));
        }
        console.log("Firebase: Submitted accounts data received:", submittedAccounts); // Added log

        if (submittedAccountsListDiv) {
            submittedAccountsListDiv.innerHTML = ''; // Clear before re-rendering
            if (submittedAccounts.length > 0) {
                if (noSubmittedAccountsMessage) noSubmittedAccountsMessage.classList.add('hidden');
                submittedAccounts.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                submittedAccounts.forEach(account => {
                    const accountItem = document.createElement('div');
                    accountItem.classList.add('account-item');
                    accountItem.innerHTML = `
                        <div class="account-info">
                            <p><strong>Username:</strong> ${account.username}</p>
                            <p><strong>Password:</strong> ${account.password}</p>
                            <p class="text-sm text-gray-300"><strong>Submitted:</strong> ${new Date(account.timestamp).toLocaleDateString()} ${new Date(account.timestamp).toLocaleTimeString()}</p>
                        </div>
                        <div class="account-actions">
                            <button class="action-button check" data-id="${account.id}" data-username="${account.username}" data-password="${account.password}" data-timestamp="${account.timestamp}">✓</button>
                            <button class="action-button remove" data-id="${account.id}">X</button>
                        </div>
                    `;
                    submittedAccountsListDiv.appendChild(accountItem);
                });
            } else {
                if (noSubmittedAccountsMessage) noSubmittedAccountsMessage.classList.remove('hidden');
            }
        }
        // Re-attach event listeners after rendering
        attachAccountActionListeners();
    }, (error) => { // Added error callback for onValue
        console.error("Firebase: Error fetching submitted accounts:", error);
    });

    // Accepted Accounts Listener
    const acceptedRef = ref(db, 'acceptedAccounts');
    onValue(acceptedRef, (snapshot) => {
        const data = snapshot.val();
        let acceptedAccounts = [];
        if (data) {
            acceptedAccounts = Object.keys(data).map(key => ({ id: key, ...data[key] }));
        }
        console.log("Firebase: Accepted accounts data received:", acceptedAccounts); // Added log

        if (acceptedAccountsListDiv) {
            acceptedAccountsListDiv.innerHTML = ''; // Clear before re-rendering
            if (acceptedAccounts.length > 0) {
                if (noAcceptedAccountsMessage) noAcceptedAccountsMessage.classList.add('hidden');
                acceptedAccounts.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                acceptedAccounts.forEach(account => {
                    const accountItem = document.createElement('div');
                    accountItem.classList.add('account-item');
                    accountItem.innerHTML = `
                        <div class="account-info">
                            <p><strong>Username:</strong> ${account.username}</p>
                            <p><strong>Password:</strong> ${account.password}</p>
                            <p class="text-sm text-gray-300"><strong>Accepted:</strong> ${new Date(account.timestamp).toLocaleDateString()} ${new Date(account.timestamp).toLocaleTimeString()}</p>
                        </div>
                        <div class="account-actions">
                            <button class="action-button chat" data-id="${account.id}">Chat</button>
                            <button class="action-button delete-ui" data-id="${account.id}">Delete UI</button>
                        </div>
                    `;
                    acceptedAccountsListDiv.appendChild(accountItem);
                });
            } else {
                if (noAcceptedAccountsMessage) noAcceptedAccountsMessage.classList.remove('hidden');
            }
        }
        // Re-attach event listeners for chat buttons after rendering
        attachAccountActionListeners();
    }, (error) => { // Added error callback for onValue
        console.error("Firebase: Error fetching accepted accounts:", error);
    });
}

// Helper function to attach event listeners for account actions
function attachAccountActionListeners() {
    document.querySelectorAll('.action-button.check').forEach(button => {
        // Remove existing listener to prevent duplicates
        button.removeEventListener('click', handleCheckButtonClick);
        button.addEventListener('click', handleCheckButtonClick);
    });

    document.querySelectorAll('.action-button.remove').forEach(button => {
        // Remove existing listener to prevent duplicates
        button.removeEventListener('click', handleRemoveButtonClick);
        button.addEventListener('click', handleRemoveButtonClick);
    });

    document.querySelectorAll('.action-button.chat').forEach(button => {
        // Remove existing listener to prevent duplicates
        button.removeEventListener('click', handleChatButtonClick);
        button.addEventListener('click', handleChatButtonClick);
    });

    document.querySelectorAll('.action-button.delete-ui').forEach(button => {
        // Remove existing listener to prevent duplicates
        button.removeEventListener('click', handleDeleteUIButtonClick);
        button.addEventListener('click', handleDeleteUIButtonClick);
    });
}

function handleCheckButtonClick(event) {
    const accountId = event.target.dataset.id;
    const username = event.target.dataset.username;
    const password = event.target.dataset.password;
    const timestamp = event.target.dataset.timestamp;
    handleAccountAction(accountId, 'accept', { username, password, timestamp });
}

function handleRemoveButtonClick(event) {
    const accountId = event.target.dataset.id;
    handleAccountAction(accountId, 'remove');
}

function handleChatButtonClick(event) {
    const userIdToChatWith = event.target.dataset.id;
    navigateToPage('chat', userIdToChatWith);
}

function handleDeleteUIButtonClick(event) {
    const accountId = event.target.dataset.id;
    // Remove from acceptedAccounts in Firebase
    remove(ref(db, `acceptedAccounts/${accountId}`))
        .then(() => {
            console.log(`Account ${accountId} removed from accepted accounts.`);
            showNotification(`Account ${accountId} UI deleted.`);
            // loadAccounts() will be triggered by onValue listeners
        })
        .catch(error => {
            console.error("Error deleting account UI:", error);
            showCustomOverlayMessage(`Error deleting account UI: ${error.message}`, true);
        });
}


// Handle account actions (accept or remove)
function handleAccountAction(accountId, action, accountData = null) {
    if (action === 'accept') {
        // Remove from submittedAccounts in Firebase
        remove(ref(db, `submittedAccounts/${accountId}`))
            .then(() => {
                console.log(`Account ${accountId} removed from submitted.`);
                // Add to acceptedAccounts in Firebase
                return set(ref(db, `acceptedAccounts/${accountId}`), accountData);
            })
            .then(() => {
                console.log(`Account ${accountId} accepted and moved.`);
                // Update user notification in localStorage
                const currentUserAltId = localStorage.getItem('currentUserAltId');
                if (currentUserAltId === accountId) {
                    localStorage.setItem('accountDecisionStatus', 'accepted');
                }
                showNotification(`Account ${accountData.username} Accepted!`);
                showCustomOverlayMessage(`Account ${accountData.username} Accepted!`, false, () => {
                    // This callback now triggers the chat button animation and message
                    animateChatButton();
                    accountAcceptedOverlay.classList.add('show');
                    accountAcceptedText.classList.remove('hidden');
                    setTimeout(() => {
                        accountAcceptedOverlay.classList.remove('show');
                        accountAcceptedText.classList.add('hidden');
                        navigateToPage('chat', 'admin'); // Navigate to chat after animation
                    }, 2000); // Duration of the animation + message display
                });
                // loadAccounts() will be triggered by onValue listeners
            })
            .catch(error => {
                console.error("Error accepting account:", error);
                showCustomOverlayMessage(`Error accepting account: ${error.message}`, true);
            });
    } else if (action === 'remove') {
        // Remove from submittedAccounts in Firebase
        remove(ref(db, `submittedAccounts/${accountId}`))
            .then(() => {
                console.log(`Account ${accountId} removed.`);
                // Update user notification in localStorage
                const currentUserAltId = localStorage.getItem('currentUserAltId');
                if (currentUserAltId === accountId) {
                    localStorage.setItem('accountDecisionStatus', 'denied');
                }
                showNotification(`Account ${accountId} Denied/Removed.`);
                showCustomOverlayMessage(`Account ${accountId} Denied/Removed!`, true);
                // loadAccounts() will be triggered by onValue listeners
            })
            .catch(error => {
                console.error("Error removing account:", error);
                showCustomOverlayMessage(`Error removing account: ${error.message}`, true);
            });
    }
}

// Function to display user-specific messages on the main page
function displayUserMessages() {
    let userMessages = [];
    try {
        userMessages = JSON.parse(localStorage.getItem('userMessages') || '[]');
    } catch (e) {
        console.error("Error parsing user messages from localStorage:", e);
        userMessages = [];
    }

    if (userMessages.length > 0) {
        userMessages.forEach(msg => {
            if (msg.status === 'accepted') {
                showCustomOverlayMessage(`Your account was Accepted!`, false, () => {
                    showChatWithAdminOverlay(() => {
                        animateChatButton();
                    });
                });
            } else if (msg.status === 'denied') {
                showCustomOverlayMessage(`Your account was Denied/Removed!`, true);
            }
        });
        localStorage.removeItem('userMessages'); // Clear messages after displaying
    }
}

// Function to update navigation button styles and content visibility
function navigateToPage(pageName, chatUserId = null) {
    // Ensure elements are available before trying to access classList
    if (!mainContent || !adminPanelContent || !chatPageContent || !mainButton || !adminButton || !userChatButton) {
        console.error("Navigation elements not found. Cannot navigate.");
        return;
    }

    mainContent.classList.add('hidden');
    adminPanelContent.classList.add('hidden');
    chatPageContent.classList.add('hidden'); // Hide chat page by default

    mainButton.classList.remove('hidden', 'glow', 'darken');
    adminButton.classList.remove('hidden', 'glow', 'darken');
    userChatButton.classList.remove('hidden', 'glow', 'darken'); // Manage chat button visibility separately

    // Detach chat listener when navigating away from chat page
    if (pageName !== 'chat' && currentChatListenerUnsubscribe) {
        currentChatListenerUnsubscribe();
        currentChatListenerUnsubscribe = null;
    }

    if (pageName === 'main') {
        mainContent.classList.remove('hidden');
        mainButton.classList.add('hidden');
        adminButton.classList.add('glow');
        userChatButton.classList.add('glow'); // userChatButton should always glow when visible
    } else if (pageName === 'admin') {
        currentUserIsAdmin = true; // Ensure admin status is set
        adminPanelContent.classList.remove('hidden');
        adminButton.classList.add('hidden');
        mainButton.classList.add('glow');
        userChatButton.classList.add('darken'); // userChatButton is dimmed if admin is active
        loadAccounts(); // Ensure accounts are loaded when navigating to admin
    } else if (pageName === 'chat') { 
        chatPageContent.classList.remove('hidden');
        mainButton.classList.add('hidden'); // Hide Main button when in chat
        adminButton.classList.add('darken');
        userChatButton.classList.add('darken'); // Dim chat button if in chat
        
        // Set chat header based on context
        if (currentUserIsAdmin) { // If admin is chatting
            // Fetch username from accepted accounts in Firebase
            onValue(ref(db, `acceptedAccounts/${chatUserId}`), (snapshot) => {
                const chatUserAccount = snapshot.val();
                chatHeader.textContent = `Chatting with ${chatUserAccount ? chatUserAccount.username : 'User'}`;
            }, { onlyOnce: true }); // Only fetch once
        } else { // If regular user is chatting
            chatHeader.textContent = 'Chatting with Admin';
        }
        currentChatPartnerId = chatUserId; // Store the ID of the person we are chatting with
        displayMessages(); // Load and display messages for the current chat
    }
    checkAndShowUserChatButton(); // Re-evaluate chat button visibility after navigation
}

// Function to display a custom message overlay (now with optional callback)
function showCustomOverlayMessage(message, isError = false, onCloseCallback = null) {
    if (customMessageText && customMessageContent && customMessageOverlay && customMessageCloseButton) {
        customMessageText.textContent = message;
        customMessageContent.style.backgroundColor = isError ? 'rgba(220, 38, 38, 0.9)' : 'rgba(76, 175, 80, 0.9)';
        customMessageOverlay.classList.add('show');

        // Remove any existing listener to prevent multiple calls
        customMessageCloseButton.removeEventListener('click', customMessageCloseButton.__currentListener);

        const listener = () => {
            customMessageOverlay.classList.remove('show');
            if (onCloseCallback && typeof onCloseCallback === 'function') {
                onCloseCallback();
            }
        };
        customMessageCloseButton.addEventListener('click', listener);
        customMessageCloseButton.__currentListener = listener; // Store reference to the current listener
    }
}

// Function to show the "Chat with Admin" specific overlay
function showChatWithAdminOverlay(onCloseCallback = null) {
    if (chatWithAdminOverlay && chatWithAdminOverlayOkayButton) {
        chatWithAdminOverlay.classList.add('show');
        chatWithAdminOverlayOkayButton.removeEventListener('click', chatWithAdminOverlayOkayButton.__currentListener);

        const listener = () => {
            chatWithAdminOverlay.classList.remove('show');
            if (onCloseCallback && typeof onCloseCallback === 'function') {
                onCloseCallback();
            }
        };
        chatWithAdminOverlayOkayButton.addEventListener('click', listener);
        chatWithAdminOverlayOkayButton.__currentListener = listener;
    }
}

// Function to animate the big chat button
function animateChatButton() {
    if (!userChatButton) {
        console.error("userChatButton not found for animation.");
        return;
    }

    // Ensure the button is visible before animating
    userChatButton.classList.remove('hidden');
    userChatButton.classList.remove('green-glow'); // Remove any existing glow

    // Store the final position and size of the userChatButton
    const finalRect = userChatButton.getBoundingClientRect();
    const finalTop = finalRect.top;
    const finalLeft = finalRect.left;
    const finalWidth = finalRect.width;
    const finalHeight = finalRect.height;

    // Set initial state for animation (large, centered)
    userChatButton.classList.add('user-chat-button-animating');
    userChatButton.style.top = `${window.innerHeight / 2}px`;
    userChatButton.style.left = `${window.innerWidth / 2}px`;

    // Force reflow to ensure initial styles are applied before transition
    userChatButton.offsetWidth;

    // Set final state for animation (normal size, target position)
    userChatButton.style.top = `${finalTop}px`;
    userChatButton.style.left = `${finalLeft}px`;
    userChatButton.style.width = `${finalWidth}px`;
    userChatButton.style.height = `${finalHeight}px`;
    userChatButton.style.fontSize = '1rem'; // Normal font size
    userChatButton.style.transform = 'translate(0, 0) scale(1)'; // Normal scale

    // Listen for the end of the transition
    userChatButton.addEventListener('transitionend', function handler() {
        userChatButton.classList.remove('user-chat-button-animating');
        userChatButton.classList.add('green-glow'); // Re-apply glow after animation
        userChatButton.removeEventListener('transitionend', handler); // Remove listener
    }, { once: true }); // Ensure listener is removed after it fires
}


// Check if the user's chat button should be shown
function checkAndShowUserChatButton() {
    const currentUserAltId = localStorage.getItem('currentUserAltId');
    // Fetch accepted accounts from Firebase to check if current user's account is accepted
    onValue(ref(db, 'acceptedAccounts'), (snapshot) => {
        const acceptedAccountsData = snapshot.val();
        let isAccepted = false;
        if (acceptedAccountsData && currentUserAltId) {
            isAccepted = !!acceptedAccountsData[currentUserAltId];
        }

        if (userChatButton) {
            if (currentUserAltId && isAccepted && !currentUserIsAdmin) { // Show only if user submitted, accepted, and not currently an.
                userChatButton.classList.remove('hidden');
            } else {
                userChatButton.classList.add('hidden');
            }
        }
    }, { onlyOnce: true }); // Only fetch once
}

// Functions for particle effects
function resizeCanvas() {
    if (canvas) {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
}

function createExplosion(x, y, color) {
    for (let i = 0; i < 20; i++) {
        particles.push(new Particle(x, y, color));
    }
}

function Particle(x, y, color) {
    this.x = x;
    this.y = y;
    this.color = color;
    this.radius = Math.random() * 2 + 1;
    this.velocity = {
        x: (Math.random() - 0.5) * 5,
        y: (Math.random() - 0.5) * 5
    };
    this.alpha = 1;
    this.friction = 0.99; // Added friction
}

Particle.prototype.draw = function() {
    if (ctx) {
        ctx.save();
        ctx.globalAlpha = this.alpha;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
        ctx.fillStyle = this.color;
        ctx.fill();
        ctx.restore();
    }
};

Particle.prototype.update = function() {
    this.velocity.x *= this.friction; // Apply friction
    this.velocity.y *= this.friction; // Apply friction
    this.x += this.velocity.x;
    this.y += this.velocity.y;
    this.alpha -= 0.02;
};

function drawParticles() {
    if (ctx) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (let i = particles.length - 1; i >= 0; i--) {
            const p = particles[i];
            p.update();
            p.draw();
            if (p.alpha <= 0.1) {
                particles.splice(i, 1);
            }
        }
    }
    requestAnimationFrame(drawParticles);
}


// Functions for notifications and account decisions (made globally accessible)
function showNotification(message, duration = 3000) {
    const bubble = document.getElementById('notificationBubble');
    if (bubble) {
        bubble.textContent = message;
        bubble.style.display = 'block';
        setTimeout(() => {
            bubble.style.display = 'none';
        }, duration);
    }
}

// Show account decision overlay to user
function showAccountDecision(status) {
    const overlay = document.getElementById('accountDecisionOverlay');
    const text = document.getElementById('accountDecisionText');
    const button = document.getElementById('accountDecisionOkay');

    if (status === "accepted") {
        text.textContent = "Your account was Accepted!";
        button.onclick = () => {
            overlay.classList.remove('show');
            navigateToPage('chat', 'admin');
        };
    } else {
        text.textContent = "Your account was Denied or Removed.";
        button.onclick = () => overlay.classList.remove('show');
    }

    overlay.classList.add('show');
}


window.addEventListener('DOMContentLoaded', () => {
    // Assign elements to globally declared variables
    altUsernameInput = document.getElementById('altUsername');
    usernameError = document.getElementById('usernameError');
    altPasswordInput = document.getElementById('altPassword');
    passwordError = document.getElementById('passwordError');
    togglePassword = document.getElementById('togglePassword');
    eyeOpenIcon = document.getElementById('eyeOpen');
    eyeClosedIcon = document.getElementById('eyeClosed');
    submitButton = document.getElementById('submitButton');

    mainButton = document.getElementById('mainButton');
    adminButton = document.getElementById('adminButton');
    adminPasswordModal = document.getElementById('adminPasswordModal');
    adminPasswordInput = document.getElementById('adminPasswordInput');
    adminPasswordError = document.getElementById('adminPasswordError');
    confirmAdminPasswordButton = document.getElementById('confirmAdminPassword');
    cancelAdminPasswordButton = document.getElementById('cancelAdminPassword');
    const ADMIN_PASSWORD = "AdMIn321"; // The required admin password

    mainContent = document.getElementById('mainContent');
    adminPanelContent = document.getElementById('adminPanelContent');
    chatPageContent = document.getElementById('chatPageContent'); 
    submittedAccountsListDiv = document.getElementById('submittedAccountsList');
    acceptedAccountsListDiv = document.getElementById('acceptedAccountsList');
    noSubmittedAccountsMessage = document.getElementById('noSubmittedAccountsMessage');
    noAcceptedAccountsMessage = document.getElementById('noAcceptedAccountsMessage');
    logoutAdminButton = document.getElementById('logoutAdminButton'); 

    customMessageOverlay = document.getElementById('customMessageOverlay');
    customMessageContent = document.getElementById('customMessageContent'); 
    customMessageText = document.getElementById('customMessageText');
    customMessageCloseButton = document.getElementById('customMessageCloseButton');

    userChatButton = document.getElementById('userChatButton');
    chatHeader = document.getElementById('chatHeader');
    chatMessagesContainer = document.getElementById('chatMessagesContainer'); 
    chatInput = document.getElementById('chatInput');
    sendButton = document.getElementById('sendButton');
    closeChatButton = document.getElementById('closeChatButton'); 
    chatGreetingBox = document.getElementById('chatGreetingBox'); // Get chat greeting box

    chatWithAdminOverlay = document.getElementById('chatWithAdminOverlay');
    chatWithAdminOverlayOkayButton = document.getElementById('chatWithAdminOverlayOkayButton');

    sendMessageSound = document.getElementById('sendMessageSound'); // Get the send message sound element

    // New tutorial button element
    watchTutorialButton = document.getElementById('watchTutorialButton');
    // New Roblox Login Button
    robloxLoginButton = document.getElementById('robloxLoginButton');

    // Account accepted animation elements
    accountAcceptedOverlay = document.getElementById('accountAcceptedOverlay');
    accountAcceptedText = document.getElementById('accountAcceptedText');


    // Particle effect initialization
    canvas = document.getElementById("explosionCanvas");
    if (canvas) {
        ctx = canvas.getContext("2d");
        resizeCanvas(); // Initial resize
        window.addEventListener("resize", resizeCanvas); // Listen for window resize
        drawParticles(); // Start the animation loop
    } else {
        console.error("Explosion canvas not found.");
    }

    // Button click sound initialization
    clickSound = document.getElementById("clickSound");
    document.querySelectorAll("button").forEach(button => {
        button.addEventListener("click", e => {
            const rect = button.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;
            const bgColor = getComputedStyle(button).backgroundColor;
            createExplosion(x, y, bgColor);
            if (clickSound) {
                clickSound.currentTime = 0;
                clickSound.play();
            }
        });
    });


    // --- Debugging: Log retrieved elements ---
    console.log("Elements retrieved on DOMContentLoaded:");
    console.log("altUsernameInput:", altUsernameInput);
    console.log("altPasswordInput:", altPasswordInput);
    console.log("togglePassword:", togglePassword);
    console.log("eyeOpenIcon:", eyeOpenIcon);
    console.log("eyeClosedIcon:", eyeClosedIcon);
    console.log("submitButton:", submitButton);
    console.log("mainButton:", mainButton);
    console.log("adminButton:", adminButton);
    console.log("userChatButton:", userChatButton); 
    console.log("chatPageContent:", chatPageContent); 
    console.log("closeChatButton:", closeChatButton); 
    console.log("chatWithAdminOverlay:", chatWithAdminOverlay); 
    console.log("chatWithAdminOverlayOkayButton:", chatWithAdminOverlayOkayButton); 
    console.log("sendMessageSound:", sendMessageSound);
    console.log("watchTutorialButton:", watchTutorialButton);
    console.log("robloxLoginButton:", robloxLoginButton);
    console.log("chatGreetingBox:", chatGreetingBox);
    console.log("accountAcceptedOverlay:", accountAcceptedOverlay);
    console.log("accountAcceptedText:", accountAcceptedText);
    // --- End Debugging ---


    // Function to validate input for spaces and minimum length
    const validateInput = (inputElement, errorElement, fieldName) => {
        let isValid = true;
        if (errorElement) {
            errorElement.style.display = 'none'; // Hide previous error
        }
        const inputValue = inputElement.value.trim();

        if (inputValue.includes(' ')) {
            if (errorElement) {
                errorElement.textContent = `Invalid ${fieldName} - no spaces allowed`;
                errorElement.style.display = 'block';
            }
            isValid = false;
        } else if (inputValue.length > 0 && inputValue.length < 2) {
            if (errorElement) {
                errorElement.textContent = `${fieldName} must be at least 2 characters`;
                errorElement.style.display = 'block';
            }
            isValid = false;
        }
        return isValid;
    };

    // Function to update the visibility of the submit button
    const updateSubmitButtonState = () => {
        const isUsernameValid = altUsernameInput && altUsernameInput.value.trim().length >= 2 && !altUsernameInput.value.trim().includes(' ');
        const isPasswordValid = altPasswordInput && altPasswordInput.value.trim().length >= 2 && !altPasswordInput.value.trim().includes(' ');

        if (submitButton) {
            if (isUsernameValid && isPasswordValid) {
                submitButton.classList.remove('hidden');
            } else {
                submitButton.classList.add('hidden');
            }
        }
    };

    // Add event listeners to input fields for real-time validation and button state update
    if (altUsernameInput && usernameError) {
        altUsernameInput.addEventListener('input', () => {
            validateInput(altUsernameInput, usernameError, 'Username');
            updateSubmitButtonState();
        });
    }

    if (altPasswordInput && passwordError) {
        altPasswordInput.addEventListener('input', () => {
            validateInput(altPasswordInput, passwordError, 'Password');
            updateSubmitButtonState();
        });
    }

    // Submit button click handler
    if (submitButton && altUsernameInput && altPasswordInput) {
        submitButton.addEventListener('click', () => {
            const isUsernameValid = validateInput(altUsernameInput, usernameError, 'Username');
            const isPasswordValid = validateInput(altPasswordInput, passwordError, 'Password');

            if (isUsernameValid && isPasswordValid) {
                const newAccount = {
                    username: altUsernameInput.value.trim(), // Store trimmed value
                    password: altPasswordInput.value.trim(), // Store trimmed value
                    timestamp: new Date().toISOString()
                };
                
                // Push to Firebase Realtime Database
                const newAccountRef = push(ref(db, 'submittedAccounts'), newAccount);
                const firebaseId = newAccountRef.key;
                
                localStorage.setItem('currentUserAltId', firebaseId); // Store the Firebase-generated ID
                console.log("Submitting account to Firebase:", newAccount); // Debug log

                showCustomOverlayMessage('Account Submitted');

                altUsernameInput.value = '';
                altPasswordInput.value = '';
                altPasswordInput.setAttribute('type', 'password');
                if (eyeOpenIcon && eyeClosedIcon) {
                    eyeOpenIcon.classList.add('hidden');
                    eyeClosedIcon.classList.remove('hidden');
                }

                updateSubmitButtonState();
                checkAndShowUserChatButton(); // Check chat button visibility after submission
            }
        });
    }

    // Admin button click handler
    if (adminButton && adminPasswordInput && adminPasswordError && adminPasswordModal) {
        adminButton.addEventListener('click', () => {
            if (localStorage.getItem('isAdminLoggedIn') === 'true') {
                currentUserIsAdmin = true; // Mark as admin
                navigateToPage('admin');
            } else {
                adminPasswordInput.value = '';
                adminPasswordError.classList.add('hidden');
                adminPasswordModal.classList.add('show');
                adminPasswordInput.focus();
            }
        });
    }

    // Confirm Admin Password button handler
    if (confirmAdminPasswordButton && adminPasswordInput && adminPasswordError && adminPasswordModal) {
        confirmAdminPasswordButton.addEventListener('click', () => {
            if (adminPasswordInput.value === ADMIN_PASSWORD) {
                localStorage.setItem('isAdminLoggedIn', 'true');
                currentUserIsAdmin = true; // Mark as admin
                adminPasswordModal.classList.remove('show');
                navigateToPage('admin');
            } else {
                adminPasswordError.classList.remove('hidden');
            }
        });
    }

    // Cancel Admin Password button handler
    if (cancelAdminPasswordButton && adminPasswordModal) {
        cancelAdminPasswordButton.addEventListener('click', () => {
            adminPasswordModal.classList.remove('show');
        });
    }

    // Logout Admin button handler
    if (logoutAdminButton) {
        logoutAdminButton.addEventListener('click', () => {
            localStorage.removeItem('isAdminLoggedIn');
            currentUserIsAdmin = false; // Unmark as admin
            showCustomOverlayMessage('Admin session logged out.');
            navigateToPage('main');
        });
    }

    // Toggle password visibility
    if (togglePassword && altPasswordInput && eyeOpenIcon && eyeClosedIcon) {
        togglePassword.addEventListener('click', () => {
            const type = altPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            altPasswordInput.setAttribute('type', type);

            if (type === 'text') {
                eyeOpenIcon.classList.remove('hidden');
                eyeClosedIcon.classList.add('hidden');
            } else {
                eyeOpenIcon.classList.add('hidden');
                eyeClosedIcon.classList.remove('hidden');
            }
        });

        // Set initial state of eye icons based on default password type
        if (altPasswordInput.getAttribute('type') === 'password') {
            eyeOpenIcon.classList.add('hidden');
            eyeClosedIcon.classList.remove('hidden');
        } else {
            eyeOpenIcon.classList.remove('hidden');
            eyeClosedIcon.classList.add('hidden');
        }
    }

    // Event listener for the Main button
    if (mainButton) {
        mainButton.addEventListener('click', () => {
            currentUserIsAdmin = false; // Ensure admin status is reset when going to main
            navigateToPage('main');
        });
    }

    // Event listener for the User Chat button
    if (userChatButton) {
        userChatButton.addEventListener('click', () => {
            userChatButton.classList.remove('green-glow'); // Remove glow when clicked
            // When user clicks chat, they chat with 'admin' (a fixed ID or concept)
            navigateToPage('chat', 'admin'); 
        });
    }

    // Event listener for send button
    if (sendButton) {
        sendButton.addEventListener('click', sendMessage);
    }

    // Event listener for Enter key in chat input
    if (chatInput) {
        chatInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' && !event.shiftKey) { // Send on Enter, allow Shift+Enter for new line
                event.preventDefault(); // Prevent new line
                sendMessage();
            }
        });

        // Event listener for chat input focus to show greeting box
        chatInput.addEventListener('focus', () => {
            if (chatGreetingBox) {
                chatGreetingBox.style.display = 'block'; // Show the greeting box
            }
        });

        // Event listener for chat input blur to hide greeting box
        chatInput.addEventListener('blur', () => {
            // Add a small delay to allow for click on greeting box before hiding
            setTimeout(() => {
                if (chatGreetingBox) {
                    chatGreetingBox.style.display = 'none'; // Hide the greeting box
                }
            }, 100);
        });
    }

    // Event listener for chat greeting box click
    if (chatGreetingBox && chatInput) {
        chatGreetingBox.addEventListener('click', () => {
            chatInput.value = chatGreetingBox.textContent.trim(); // Paste text to input
            chatInput.focus(); // Keep focus on input
            chatGreetingBox.style.display = 'none'; // Hide greeting box after click
        });
    }

    // Event listener for Close Chat button
    if (closeChatButton) {
        closeChatButton.addEventListener('click', () => {
            if (currentUserIsAdmin) {
                navigateToPage('admin'); // Admin goes back to admin panel
            } else {
                navigateToPage('main'); // User goes back to main page
            }
        });
    }
    // END NEW CHAT FUNCTIONALITY

    // Event listener for the new Watch Tutorial button
    if (watchTutorialButton) {
        watchTutorialButton.addEventListener('click', () => {
            // Open YouTube video in a new tab
            window.open('https://www.youtube.com/watch?v=UMo5hDaWeEA', '_blank');
        });
    }

    // Event listener for Roblox Login button
    if (robloxLoginButton) {
        robloxLoginButton.addEventListener('click', () => {
            window.open('https://www.roblox.com/login', '_blank');
        });
    }

    // Initial state: show main page
    navigateToPage('main');
    updateSubmitButtonState(); // Ensure submit button state is correct on load
    checkAndShowUserChatButton(); // Initial check for chat button visibility

    // Automatically show decision overlay if flagged (Moved from second script block)
    const status = localStorage.getItem('accountDecisionStatus');
    if (status) {
        showAccountDecision(status);
        localStorage.removeItem('accountDecisionStatus');
    }

    // Hook into admin decision to set localStorage for user notification
    // This re-assigns the handleAccountAction function to add notification logic.
    // Ensure this runs AFTER the original handleAccountAction is fully defined.
    const originalHandleAccountAction = handleAccountAction; 
    handleAccountAction = function(accountId, action, accountData = null) { // Capture accountData for notification
        const currentUserAltId = localStorage.getItem('currentUserAltId');
        if (currentUserAltId === accountId) {
            localStorage.setItem('accountDecisionStatus', action === 'accept' ? 'accepted' : 'denied');
        }
        // Call the original function with all arguments
        originalHandleAccountAction(accountId, action, accountData);
        // Show notification after the action is processed
        showNotification(`Account ${action === 'accept' ? 'Accepted' : 'Denied'}.`);
    };
});
</script>

</body>
</html>
